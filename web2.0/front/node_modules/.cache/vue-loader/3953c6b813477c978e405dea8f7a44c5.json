{"remainingRequest":"/Users/user/Desktop/web2.0/WeIns_F/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/user/Desktop/web2.0/WeIns_F/src/components/signinForm.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/user/Desktop/web2.0/WeIns_F/src/components/signinForm.vue","mtime":1595317097020},{"path":"/Users/user/Desktop/web2.0/WeIns_F/node_modules/cache-loader/dist/cjs.js","mtime":1594082385499},{"path":"/Users/user/Desktop/web2.0/WeIns_F/node_modules/babel-loader/lib/index.js","mtime":1594082385506},{"path":"/Users/user/Desktop/web2.0/WeIns_F/node_modules/cache-loader/dist/cjs.js","mtime":1594082385499},{"path":"/Users/user/Desktop/web2.0/WeIns_F/node_modules/vue-loader/lib/index.js","mtime":1594082401315}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBheGlvcyBmcm9tICdheGlvcyc7CmV4cG9ydCBkZWZhdWx0IHsKICAgIGRhdGEoKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgY2hlY2tlZDogZmFsc2UsCiAgICAgICAgICAgIGlzU3VibWl0OiBmYWxzZSwKICAgICAgICAgICAgZXJybWVzc2FnZToiIiwKICAgICAgICAgICAgZm9ybTogewogICAgICAgICAgICAgICAgcGhvbmU6ICcnLAogICAgICAgICAgICAgICAgcGFzc3dvcmQ6ICcnLAogICAgICAgICAgICB9LAogICAgICAgIH0KICAgIH0sCiAgICBjcmVhdGVkKCkgewogICAgICAgIGlmIChzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKCJwd2QiKSAhPT0gbnVsbCkKICAgICAgICAgICAgdGhpcy5mb3JtLnBhc3N3b3JkID0gc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbSgicHdkIik7CiAgICB9LAogICAgbWV0aG9kczogewogICAgICAgIG9uU3VibWl0KCkgewogICAgICAgICAgICBpZiAoIXRoaXMuaXNTdWJtaXQpIHsKICAgICAgICAgICAgICAgIGxldCBwaG9uZSA9IHRoaXMuZm9ybS5waG9uZTsKICAgICAgICAgICAgICAgIGlmIChwaG9uZS5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmVycm1lc3NhZ2U9IueUteivneWPt+eggeS4jeiDveS4uuepuiEiOwogICAgICAgICAgICAgICAgICAgIHRoaXMuJG1lc3NhZ2UuZXJyb3IoIueUteivneWPt+eggeS4jeiDveS4uuepuiEiKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgbGV0IGZvcm1hdCA9IC9eKDFbMC05XXsxMH0pJC87CiAgICAgICAgICAgICAgICAgICAgaWYgKCFmb3JtYXQudGVzdChwaG9uZSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5lcnJtZXNzYWdlPSLnlLXor53lj7fnoIHmoLzlvI/kuI3mraPnoa4hIjsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kbWVzc2FnZS5lcnJvcigi55S16K+d5Y+356CB5qC85byP5LiN5q2j56GuISIpCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgbGV0IHB3ZCA9IHRoaXMuZm9ybS5wYXNzd29yZDsKICAgICAgICAgICAgICAgIGlmIChwd2QubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5lcnJtZXNzYWdlPSLlr4bnoIHkuI3og73kuLrnqboiOwoKICAgICAgICAgICAgICAgICAgICB0aGlzLiRtZXNzYWdlLmVycm9yKCLlr4bnoIHkuI3og73kuLrnqboiKSA7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmKHB3ZC5sZW5ndGggPCA2IHx8IHB3ZC5sZW5ndGggPiAxNikgewogICAgICAgICAgICAgICAgICAgIHRoaXMuZXJybWVzc2FnZT0i5a+G56CB6ZW/5bqm6aG75ZyoIDYg5YiwIDE2IOS4quWtl+espiI7CgogICAgICAgICAgICAgICAgICAgIHRoaXMuJG1lc3NhZ2UuZXJyb3IoIuWvhueggemVv+W6pumhu+WcqCA2IOWIsCAxNiDkuKrlrZfnrKYiKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdGhpcy5pc1N1Ym1pdCA9IHRydWU7IC8vIOmYsuatouaBtuaEj+WkmuasoeeCueWHuwoKICAgICAgICAgICAgICAgIGxldCB1cmwgPSAnaHR0cDovL2xvY2FsaG9zdDo4MDg4L3VzZXIvbG9naW4nICsKICAgICAgICAgICAgICAgICAgICAnP3BoPScgKyB0aGlzLmZvcm0ucGhvbmUgKwogICAgICAgICAgICAgICAgICAgICcmcHdkPScgKyB0aGlzLmZvcm0ucGFzc3dvcmQ7CgogICAgICAgICAgICAgICAgYXhpb3MucG9zdCh1cmwpLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2cocmVzcG9uc2UpOwogICAgICAgICAgICAgICAgICAgIGxldCB1c2VyID0gcmVzcG9uc2UuZGF0YTsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyh1c2VyKTsKICAgICAgICAgICAgICAgICAgICBpZiAodXNlci5pZCA+PSAwKSB7CgogICAgICAgICAgICAgICAgICAgICAgICBpZiAodXNlci50eXBlIDwgMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kbWVzc2FnZS5lcnJvcigi6K+l6LSm5oi35bey6KKr5bCB56aB77yBIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmlzU3VibWl0ID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kcm9vdC5sb2dnZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kcm9vdC5pc19zdXBlcnVzZXI9KHVzZXIudHlwZSAhPT0gMCk7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8g55m75b2V5ZCO6L+Z6YeM5a2Y5ZCE56eNc2Vzc2lvbueahOaVsOaNrgogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbSgicGhvbmUiLCB1c2VyLnBob25lKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlc3Npb25TdG9yYWdlLnNldEl0ZW0oIm5hbWUiLCB1c2VyLm5hbWUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbSgiaWQiLCB1c2VyLmlkKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlc3Npb25TdG9yYWdlLnNldEl0ZW0oInVzZXJNb25nbyIsIEpTT04uc3RyaW5naWZ5KHVzZXIudXNlck1vbmdvKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlc3Npb25TdG9yYWdlLnNldEl0ZW0oInR5cGUiLCB1c2VyLnR5cGUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbSgic2V4IiwgdXNlci5zZXgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbSgiYmlydGhkYXkiLCB1c2VyLmJpcnRoZGF5KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlc3Npb25TdG9yYWdlLnNldEl0ZW0oInJlZ190aW1lIiwgdXNlci5yZWdfdGltZSk7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8g6K6w5L2P5a+G56CBCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5jaGVja2VkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbSgicHdkIiwgdGhpcy5mb3JtLnBhc3N3b3JkKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodXNlci50eXBlID09PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5lcnJtZXNzYWdlID0gJ+eUqOaItyAnICsgdXNlci5uYW1lICsgJyDnmbvlvZXmiJDlip/vvIEnOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHVzZXIudHlwZSA9PT0gOCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZXJybWVzc2FnZSA9ICfogIHmnb/lpb3vvIEnOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZXJybWVzc2FnZSA9ICfnrqHnkIblkZjnlKjmiLcnICsgdXNlci5uYW1lICsgJ+eZu+W9leaIkOWKnyc7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kbWVzc2FnZS5zdWNjZXNzKHRoaXMuZXJybWVzc2FnZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAodXNlci5pZCA9PT0gLTEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZXJybWVzc2FnZT0n5q2k6LSm5oi35LiN5a2Y5Zyo77yBJzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuJG1lc3NhZ2UuZXJyb3IoJ+atpOi0puaIt+S4jeWtmOWcqO+8gScpOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICBpZiAodXNlci5pZCA9PT0gLTIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZXJybWVzc2FnZT0n5a+G56CB6ZSZ6K+v77yM6K+36YeN5paw6L6T5YWl77yBJzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuJG1lc3NhZ2UuZXJyb3IoJ+WvhueggemUmeivr++8jOivt+mHjeaWsOi+k+WFpe+8gScpOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmlzU3VibWl0ID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmF4aW9zLnBvc3QodXJsKS50aGVuKHJlcz0+ewogICAgICAgICAgICAgICAgICAgIHJldHVybiByZXMgPT09ICdzdWNjZXNzJzsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9LAogICAgICAgIHNpZ251cCgpIHsKICAgICAgICAgICAgdGhpcy4kcm91dGVyLnB1c2goJy9zaWdudXAnKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSwKICAgIH0KfQo="},{"version":3,"sources":["signinForm.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAiDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"signinForm.vue","sourceRoot":"src/components","sourcesContent":["<template>\n    <div class=\"extern\">\n        <div class=\"login\">\n            <div class=\"tag\">\n                账号登录\n            </div>\n            <div style=\"width: 80%; text-align: center; margin-left: 10%\">\n                <el-menu mode=\"horizontal\" default-active=\"1\">\n                    <el-menu-item class=\"menu\" index=\"1\">普通用户</el-menu-item>\n                    <el-menu-item class=\"menu\" index=\"2\">管理员</el-menu-item>\n                </el-menu>\n            </div>\n            <div class=\"form\">\n                <el-form ref=\"form\" :model=\"form\" @keyup.native.enter=\"onSubmit\" label-width=\"11%\">\n                    <el-form-item props=\"phone\">\n                        <el-input id=\"signinForm_input_phone\"  type=\"text\" v-model=\"form.phone\"  auto-complete=\"off\" placeholder=\"请输入手机号码\"/>\n                    </el-form-item>\n                    <el-form-item prop=\"password\">\n                        <el-input\n                                id=\"signinForm_input_password\"\n                                type=\"text\" v-model=\"form.password\" auto-complete=\"off\"\n                                placeholder=\"请输入账号密码\" show-password/>\n                    </el-form-item>\n                </el-form>\n            </div>\n\n            <div class=\"pwd-mem\">\n                <div class=\"remember\">\n                    <el-checkbox v-model=\"checked\">记住密码</el-checkbox>\n                </div>\n\n                <div class=\"forget\">\n                    <el-link href=\"\">忘记密码</el-link>\n                </div>\n            </div>\n\n            <div class=\"btn\">\n                <el-button id=\"signinForm_button_login\" type=\"success\" @click=\"onSubmit\" size=\"medium\" style=\"width: 80%\">登录</el-button>\n            </div>\n\n            <div class=\"signup\">\n                <span>还没有WeIns账号？</span>\n                <router-link to=\"/signup\"><el-button id=\"signinForm_button_signup\" type=\"text\" @click=\"signup\">立即注册>></el-button></router-link>\n            </div>\n        </div>\n    </div>\n</template>\n\n<script>\n    import axios from 'axios';\n    export default {\n        data() {\n            return {\n                checked: false,\n                isSubmit: false,\n                errmessage:\"\",\n                form: {\n                    phone: '',\n                    password: '',\n                },\n            }\n        },\n        created() {\n            if (sessionStorage.getItem(\"pwd\") !== null)\n                this.form.password = sessionStorage.getItem(\"pwd\");\n        },\n        methods: {\n            onSubmit() {\n                if (!this.isSubmit) {\n                    let phone = this.form.phone;\n                    if (phone.length === 0) {\n                        this.errmessage=\"电话号码不能为空!\";\n                        this.$message.error(\"电话号码不能为空!\")\n                        return false;\n                    } else {\n                        let format = /^(1[0-9]{10})$/;\n                        if (!format.test(phone)) {\n                            this.errmessage=\"电话号码格式不正确!\";\n                            this.$message.error(\"电话号码格式不正确!\")\n                            return false;\n                        }\n                    }\n\n                    let pwd = this.form.password;\n                    if (pwd.length === 0) {\n                        this.errmessage=\"密码不能为空\";\n\n                        this.$message.error(\"密码不能为空\") ;\n                        return false;\n                    } else if(pwd.length < 6 || pwd.length > 16) {\n                        this.errmessage=\"密码长度须在 6 到 16 个字符\";\n\n                        this.$message.error(\"密码长度须在 6 到 16 个字符\");\n                        return false;\n                    }\n\n                    this.isSubmit = true; // 防止恶意多次点击\n\n                    let url = 'http://localhost:8088/user/login' +\n                        '?ph=' + this.form.phone +\n                        '&pwd=' + this.form.password;\n\n                    axios.post(url).then((response) => {\n                        console.log(response);\n                        let user = response.data;\n                        console.log(user);\n                        if (user.id >= 0) {\n\n                            if (user.type < 0) {\n                                this.$message.error(\"该账户已被封禁！\");\n                                this.isSubmit = false;\n                            }\n\n                            else {\n                                this.$root.logged = true;\n                                this.$root.is_superuser=(user.type !== 0);\n\n                                // 登录后这里存各种session的数据\n                                sessionStorage.setItem(\"phone\", user.phone);\n                                sessionStorage.setItem(\"name\", user.name);\n                                sessionStorage.setItem(\"id\", user.id);\n                                sessionStorage.setItem(\"userMongo\", JSON.stringify(user.userMongo))\n                                sessionStorage.setItem(\"type\", user.type);\n                                sessionStorage.setItem(\"sex\", user.sex);\n                                sessionStorage.setItem(\"birthday\", user.birthday);\n                                sessionStorage.setItem(\"reg_time\", user.reg_time);\n\n                                // 记住密码\n                                if (this.checked) {\n                                    sessionStorage.setItem(\"pwd\", this.form.password);\n                                }\n\n                                if (user.type === 0) {\n                                    this.errmessage = '用户 ' + user.name + ' 登录成功！';\n                                }\n\n                                else if (user.type === 8) {\n                                    this.errmessage = '老板好！';\n                                }\n\n                                else {\n                                    this.errmessage = '管理员用户' + user.name + '登录成功';\n                                }\n\n                                this.$message.success(this.errmessage);\n                            }\n                        }\n\n                        else {\n                            if (user.id === -1) {\n                                this.errmessage='此账户不存在！';\n                                this.$message.error('此账户不存在！');\n                            }\n\n                            if (user.id === -2) {\n                                this.errmessage='密码错误，请重新输入！';\n                                this.$message.error('密码错误，请重新输入！');\n                            }\n\n                            this.isSubmit = false;\n                        }\n                    })\n                    return this.axios.post(url).then(res=>{\n                        return res === 'success';\n                    });\n                }\n                return false;\n            },\n            signup() {\n                this.$router.push('/signup');\n                return true;\n            },\n        }\n    }\n</script>\n\n<style scoped>\n    .extern {\n        width: 100%;\n    }\n\n    .login {\n        width: 100%;\n        margin-top: 5%;\n        background-color: white;\n        border-radius: 2px;\n        text-align: center;\n    }\n\n    .tag {\n        font-size: 20px;\n        font-weight: 600;\n        padding-top: 20px;\n        background-color: white;\n    }\n\n\n    .menu {\n        width: 50%;\n    }\n\n    .form {\n        width: 90%;\n        margin-top: 5%;\n    }\n\n    .remember {\n        margin-left: 10%;\n        float: left;\n    }\n\n    .forget {\n        margin-right: 10%;\n        float: right;\n    }\n\n    .btn {\n        padding-top: 20px;\n    }\n\n    .signup {\n        color: #8B8B8B;\n        font-size: 12px;\n    }\n</style>\n"]}]}